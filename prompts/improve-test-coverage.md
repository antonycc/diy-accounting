## Improving Test Coverage

Please improve the test coverage by adding new tests where appropriate.

Favour **deep tests** that exercise behaviour at a high level:

- **System tests** that spin up services, or
- **Deep unit tests** with mocks when things get messy.

In doing so, aim to exercise meaningful internal paths. Where there is
complicated internal logic that is not currently tested, consider creating a
separate test file specifically for that logic.

---

## Running Coverage

To check progress with coverage, run:

```sh
npm run test:coverage
````

This maps to the following command in `package.json`:

```json
{
  "test:coverage": "npx vitest --coverage --run app/unit-tests/*.test.js app/unit-tests/*/*.test.js app/system-tests/*.test.js"
}
```

These are the locations where you can add tests to improve coverage.

---

## Testing Style Guidelines

* Favour **duplication and a clear narrative flow** in tests over heavy
  abstraction or clever spying.
* Test **only the important behaviour**.
* Do **not** test logging output (assume verbose logging is acceptable in tests).
* Review the style of tests that cover **high-level lambdas**â€”that is the
  direction to aim for.

---

## System Test Coverage

There is also a dedicated command for system tests:

```sh
npm run test:system-coverage
```

For this:

* Every file should be at least **touched** by the tests.
* Tests should be as **high level as possible**.
* Focus on exercising **resource interactions**, such as:

    * Databases
    * Networked resources
    * Payloads generated by frameworks (for example, Lambda events)

The main coverage already includes system tests, so it will naturally report
higher overall coverage. For this command, the focus is on **high-level
behaviours**, not on proving the robustness of underlying libraries.

> Avoid reformatting files you are not otherwise changing; prefer to match the existing local style where strict formatting updates would be jarring.
